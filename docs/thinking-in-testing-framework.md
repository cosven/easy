---
created: 2020-11-10 20:28
updated: 2020-11-10 20:28
---

# 测试框架的思考（个人）

测试框架是为了测试用例服务的，测试用例的生命周期大概如下

1. 设计
2. 开发
3. 调试
4. 定时运行

这里的思考专注在 2/3/4 步骤上。设计虽然重要，但目前已知的各种框架都没有考虑它。
根据测试用例的运行时长，目前，我们可以将用例分为两种

1. 短时间：确定性用例
2. 长时间：长稳用例（随机性用例）

所以本次思考的主题是：测试框架怎样服务好 “确定性用例以及长稳用例的开发、调试和定时运行”。

## 思考

开发用例需要的能力

1. 一个任意拓扑的集群
2. 能直接访问集群每个实例的接口
3. 一定的 chaos 能力，包括：网络隔离；重启；failpoint 等

调试用例需要的能力

1. 能够本地调试

运行用例需要的能力

1. 可以 scale
2. 环境足够稳定、可用、有一定的隔离性
4. 日志
5. 指标 - 报警

## 思考结果

先思考环境方面。本地调试：native/docker；可以 scale：K8s。两者存在一定冲突，
那两者可以统一么？本地可以启动一个 K8s，但坑很多；K8s 里面也可以模拟 native。

native/docker 能满足要求么
1. 长稳测试不适合在本地跑，但本地可以减少时间和循环次数
2. chaos 在 K8s/docker 上更方便

## 小结

* 调试：native > docker > K8s
* 运行：K8s > docker > native
* chaos：K8s > docker/native

jepsen 实际上就是使用了 docker 的模式，兼容虚拟机.

## 方案

```
              Test Case
                  |
                  |
               Provider
            (Cluster, Chaos)
          /                  \
         /                    \
       Native                 K8s
  (tiup-plaground, xxx)     (Chaos-mesh, TiDB-Operator)
```
